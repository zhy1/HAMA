<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/>
    <meta name="renderer" content="webkit"/>
    <title>支付宝快捷收银台</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="format-detection" content="telephone=no,email=no"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"/>
    <link rel="apple-touch-icon" href="https://i.alipayobjects.com/i/ecmng/png/201406/2qBuceUYiL.png" />
    <link rel="apple-touch-icon-precomposed" href="https://i.alipayobjects.com/i/ecmng/png/201406/2qBuceUYiL.png" />
    <!-- CMS:安全支付客户端网关/common/tracker.vm开始:common/tracker.vm -->


    <!-- CMS:安全支付客户端网关/common/tracker.vm结束:common/tracker.vm --><script charset="utf-8" src="https://a.alipayobjects.com:443/h5cashier/1.0.4/cashierH5V5.js"></script>
    <link rel="stylesheet" type="text/css" href="https://a.alipayobjects.com:443/h5cashier/1.0.3/cashierH5V5.css" media="all" />
    <script charset="utf-8" id="seajsnode" src="https://a.alipayobjects.com:443/??seajs/seajs/2.2.0/sea.js,seajs/seajs-combo/1.0.0/seajs-combo.js"></script>

    <script>
        seajs.config({
            alias: {
                '$': 'gallery/zepto/1.0.2/zepto',
                'validator': 'arale/validator/0.9.7/validator',
                'widget': 'arale/widget/1.1.1/widget',
                'base': 'arale/base/1.1.1/base',
                'class': 'arale/class/1.1.0/class',
                'events': 'arale/events/1.1.0/events',
                'wapcashier': 'mobileclientgw/wapcashier/1.1.7/wapcashier'
            },
            vars: {
                locale: 'zh-cn'
            }
        });
    </script>
</head>
<body>
<div class="J-msg-mask am-msg-mask" style="display:none"></div>
<div class="J-msg-box am-msg-box" style="display:none">
    <div class="am-msg-box-content">
        <p class="J-msg-text"></p>
        <button class="J-msg-cancel am-button am-button-blue" type="button">知道了</button>
    </div>
</div>

<div class="J-loading am-loading"><div class="am-loading-text">加载中...</div></div>

<!-- CMS:安全支付客户端网关/common/notice.vm开始:common/notice.vm --><!-- CMS:安全支付客户端网关/common/notice.vm结束:common/notice.vm -->


<!-- h5PayRoute.vm -->





<!-- v5_h5_pay_route -->
<script>window.Tracker && Tracker.click('v5_h5_pay_route')</script>


<header class="am-header">
    <h1>
        <span class="title-main" data-title="支付宝收银台">支付宝收银台</span>    </h1>

</header>


<noscript><h1 style="color:red">您的浏览器不支持JavaScript，请更换浏览器或开启JavaScript设置!</h1></noscript>
<style>
    body {
        font-weight: 500;
        font-family: PingFangSC-Regular, "Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif;
    }
    .am-header {
        display: none;
    }
    .alipay-logo {
        display: none;
    }
    .result {
        position: absolute;
        top: 50%;
        margin-top: -215px;
        width: 100%;
    }
    .result-logo {
        width: 70px;
        height: 98px;
        margin: auto;
        background-image: url(data:image/png;base64,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);
        background-repeat: no-repeat;
        background-size: contain;
    }
    .result-title {
        margin: 40px 0 14px;
        text-align: center;
        font-size: 21px;
        color: #00a0e8;
        line-height: 25px;
    }
    .result-tips {
        max-width: 370px;
        margin: 0 auto 10px;
        padding: 0 15px;
        font-size: 15px;
        color: #a5a5a5;
        line-height:18px;
        text-align:left;
        word-break:break-all;
        word-wrap:break-word;
    }
    .result-botton {
        margin: 0 15px 20px;
    }
    .result-botton a {
        display: block;
        margin: auto;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        max-width: 384px;
        height:44px;
        text-align: center;
    }
    .result-botton a.am-button-white {
        color: #00aaee;
        background:#ffffff;
        border:1px solid #00aaee;
    }
    .loading {
        display: none;
    }
</style>

<div class="loading"></div>
<div class="am-content">
    <input type="hidden" name="params" value="{&quot;server_param&quot;:&quot;c2hhcmVkX3RhaXI9dHJ1ZTs%3D&quot;,&quot;shared_tair&quot;:&quot;true&quot;}" />
    <div class="result">
        <div class="result-logo"></div>
        <div class="result-title">正在尝试打开支付宝客户端</div>
        <div class="result-tips">1.如果未打开支付宝客户端或未完成付款，请点击“继续支付”;</div>
        <div class="result-tips" style="margin-bottom: 60px;">2.如果你已完成，请点击“已完成付款”；</div>
        <div class="result-botton"><a class="J-h5pay am-button am-button-blue" href="/h5Continue.htm?h5_route_token=f6f7e1cc4c92cabd2dec4b6755a9a370">继续支付</a></div>
        <div class="result-botton"><a class="J-complete am-button am-button-white" href="#">已完成付款</a></div>
    </div>
</div>
<script type="text/javascript">
    <!-- CMS:ȫվ���� cms/common/H5cashier2client.vm��ʼ:common/H5cashier2client.vm -->//H5cashier startup client
    (function(){
        var _AP = {}

        var ua = navigator.userAgent.toLowerCase(),
                locked = false,
                domLoaded = document.readyState==='complete',
                delayToRun;

        function customClickEvent() {
            var clickEvt;
            if (window.CustomEvent) {
                clickEvt = new window.CustomEvent('click', {
                    canBubble: true,
                    cancelable: true
                });
            } else {
                clickEvt = document.createEvent('Event');
                clickEvt.initEvent('click', true, true);
            }

            return clickEvt;
        }

        function getAndroidVersion() {
            var match = ua.match(/android\s([0-9\.]*)/);
            return match ? match[1] : false;
        }

        var noIntentTest = /aliapp|360 aphone|weibo|windvane|ucbrowser/.test(ua);
        var hasIntentTest = /chrome|samsung/.test(ua);
        var isAndroid = /android|adr/.test(ua) && !(/windows phone/.test(ua));
        var canIntent = !noIntentTest && hasIntentTest && isAndroid;
        var openInIfr = /weibo|m353/.test(ua);
        var inWeibo = ua.indexOf('weibo')>-1;

        if (ua.indexOf('m353')>-1 && !noIntentTest) {
            canIntent = false;
        }

        /**
         * open client
         */
        _AP.open = function (params) {
            if (!domLoaded && (ua.indexOf('360 aphone')>-1 || canIntent)) {
                var arg = arguments;
                delayToRun = function () {
                    _AP.open.apply(null, arg);
                    delayToRun = null;
                };
                return;
            }

            if (locked) {
                return;
            }
            locked = true;

            var o;
            if (typeof params === 'object') {
                o = {
                    'ios': encodeURIComponent(JSON.stringify(params)),
                    'android': encodeURIComponent(params.dataString)
                };
            } else {
                console.error('params error, pls use JSON format!')
            }

            // params fault tolerance
            if (typeof o.ios !== 'string') {
                o.ios = '';
            } else if(typeof o.android !== 'string') {
                o.android = '';
            }

            // nonsupport Android intent
            if (!canIntent) {
                if(isAndroid) {
                    var alipaysUrl = 'alipays://platformapi/startApp?appId=20000125&orderSuffix=' + o.android;
                }
                //fix for iOS QQ browser
                else if (ua.indexOf('mqqbrowser') > -1) {
                    var alipaysUrl = 'alipay://alipayclient/?' + o.android;
                }
                else {
                    var alipaysUrl = 'alipay://alipayclient/?' + o.ios;
                }

                if ( ua.indexOf('qq/') > -1 || ( ua.indexOf('safari') > -1 && ua.indexOf('os 9_') > -1 ) ) {
                    var openSchemeLink = document.getElementById('openSchemeLink');
                    if (!openSchemeLink) {
                        openSchemeLink = document.createElement('a');
                        openSchemeLink.id = 'openSchemeLink';
                        openSchemeLink.style.display = 'none';
                        document.body.appendChild(openSchemeLink);
                    }
                    openSchemeLink.href = alipaysUrl;
                    // trigger click
                    openSchemeLink.dispatchEvent(customClickEvent());
                } else {
                    var ifr = document.createElement('iframe');
                    ifr.src = alipaysUrl;
                    ifr.style.display = 'none';
                    document.body.appendChild(ifr);
                }
            }
            //support Android intent
            else {
                var packageKey = 'AlipayGphone';
                var intentUrl = 'alipays://platformapi/startApp?appId=20000125&orderSuffix='+o.android+'#Intent;scheme=alipays;package=com.eg.android.'+ packageKey +';end';


                var openIntentLink = document.getElementById('openIntentLink');
                if (!openIntentLink) {
                    openIntentLink = document.createElement('a');
                    openIntentLink.id = 'openIntentLink';
                    openIntentLink.style.display = 'none';
                    document.body.appendChild(openIntentLink);
                }
                openIntentLink.href = intentUrl;
                // trigger click
                openIntentLink.dispatchEvent(customClickEvent());
            }

            setTimeout(function () {
                locked = false;
            }, 2500)
        }

        if (!domLoaded) {
            document.addEventListener('DOMContentLoaded', function () {
                domLoaded = true;
                if (typeof delayToRun === 'function') {
                    delayToRun();
                }
            }, false);
        }

        _AP.pay = function(param) {
            _AP.open(param);
        }
        window._AP = _AP;
    })();
    //<!-- CMS:ȫվ���� cms/common/H5cashier2client.vm����:common/H5cashier2client.vm -->
    try {
        //唤起客户端快捷参数
        var data = {"dataString":"h5_route_token=\"f6f7e1cc4c92cabd2dec4b6755a9a370\"&is_h5_route=\"true\"","requestType":"SafePay","fromAppUrlScheme":"alipays"};
        window.setTimeout(function(){
            _AP.pay(data);
        }, 50);
    }catch(e){
        window.console && window.console.log('e.name:' + e.name + ';e.message:' + e.message)
    }


    //点击完成付款再次查询交易状态
    var unDisable = true;
    $('.J-complete').on('click',function(e){
        var buttonComplete = $(this);
        //防止重复点击
        if(typeof buttonComplete.attr('disabled') == 'string') return false;

        stopQuery = true;
        if(unDisable) {
            unDisable = false;
            Zepto.ajax({
                type: 'post',
                url: '/h5/h5RoutePayResultQuery.json?operateType=1&h5_route_token=f6f7e1cc4c92cabd2dec4b6755a9a370',
                data:{
                    '_input_charset': 'utf-8',
                    'params': $('input[name=params]').val(),
                    'session': 'GZ00ZvWXRFyLaRc67oOuZJrX7bKlUfmobilecashierGZ00',
                    'r': Math.floor(Math.random()*1e13)
                },
                timeout: 30000,
                dataType: 'json',
                success: function (data) {
                    if (data.control_type == 'pay_success') {
                        if(data.data && data.data.returnUrl && data.data.returnUrl != '') {
                            window.location.replace(decodeURIComponent(data.data.returnUrl));
                        }
                    }
                    else if(data.wnd.type == 'dlg') {
                        var defaultDialog = data.wnd;
                        var defaultDialogButton = function(btns){
                            var buttons = [];
                            for (var i=0;i<btns.length;i++) {
                                buttons.push(btns[i].txt);
                            }
                            return buttons;
                        };
                        buttonComplete.attr('disabled', 'disabled')

                        Zepto.dialog.show({
                            message: defaultDialog.msg,
                            buttons: defaultDialogButton(defaultDialog.btns),
                            complete: function (result) {
                                setTimeout(function(){
                                    buttonComplete.removeAttr('disabled')
                                }, 1000)

                                if(defaultDialog.btns[result.order - 1].act.acttype == 'dismiss') {
                                    Zepto.dialog.hide();
                                    buttonComplete.attr('')
                                }
                                else if(defaultDialog.btns[result.order - 1].act.acttype == 'actionpath') {
                                    if(defaultDialog.btns[result.order - 1].act.actparams){
                                        window.location.href = 'https://mclient.alipay.com/h5/' + defaultDialog.btns[result.order - 1].act.name + '?' + defaultDialog.btns[result.order - 1].act.actparams;
                                    }else{
                                        window.location.href = 'https://mclient.alipay.com/h5/' + defaultDialog.btns[result.order - 1].act.name + '?awid=GZ00KYDaX2qplIqBXX8wVeqFnySdntmobileclientgwGZ00&session=GZ00ZvWXRFyLaRc67oOuZJrX7bKlUfmobilecashierGZ00&params=%7B%22server_param%22%3A%22c2hhcmVkX3RhaXI9dHJ1ZTs%253D%22%2C%22shared_tair%22%3A%22true%22%7D';
                                    }
                                    Zepto.dialog.hide();
                                }
                                else if(defaultDialog.btns[result.order - 1].act.acttype == 'weburl'){
                                    window.location.href = defaultDialog.btns[result.order - 1].act.name;
                                    Zepto.dialog.hide();
                                }
                            }
                        });
                    }
                },
                error: function (xhr, type) {
                },
                complete: function (xhr, type) {
                    unDisable = true;
                }
            })
        }
        e.preventDefault();
    });

    //倒计时
    var time = parseInt('6000') / 1000, loop;
    function countDown(){
        loop = window.setTimeout('countDown()',1000);
        if(time>0){
            $('.result-title').eq(0).html('正在尝试打开支付宝客户端 ' + time+ 's');
            time--;
        }
        else{
            $('.result-title').eq(0).html('');
            clearTimeout(loop);
        }
    }
    countDown();


    $(function(){

        if(top.location != location){
            $("body").append('<img src="https://mclient.alipay.com/h5/commlog.htm?t=SNEAK_LINK&c=' + encodeURIComponent(window.document.referrer) + '" width="1" height="1" />');
        }

        $('.J-header-return').on('click',function(e){
            var el = this;
            Zepto.dialog.show({
                message: $(this).attr('data-confirm-text'),
                buttons: ['否', '是'],
                complete: function (result) {
                    if(result.order === 2) {
                        window.location.href = $(el).attr('href');
                    } else {
                        Zepto.dialog.hide();
                    }
                }
            })
            e.preventDefault();
        });



        $('.J-loading').addClass('fn-hide');

        //停止轮询
        var stopQuery = false;
        //轮询间隔时间(默认10s)
        var timeCount = parseInt('3000') || 3000;
        var invokeAlipay;

        //轮询
        var payquery = function () {
            if(stopQuery) { return }
            var argumentsPayquery = arguments;
            Zepto.ajax({
                type: 'post',
                url: '/h5/h5RoutePayResultQuery.json?h5_route_token=f6f7e1cc4c92cabd2dec4b6755a9a370',
                data:{
                    '_input_charset': 'utf-8',
                    'params': $('input[name=params]').val(),
                    'session': 'GZ00ZvWXRFyLaRc67oOuZJrX7bKlUfmobilecashierGZ00'
                },
                timeout: 30000,
                dataType: 'json',
                success: function (data) {
                    //已唤起支付宝客户端
                    if(data.data.invokeAlipay && time){
                        time = 0;
                    }

                    //成功
                    if(data.control_type == 'pay_success') {
                        if(data.data && data.data.returnUrl && data.data.returnUrl != '') {
                            window.location.replace(decodeURIComponent(data.data.returnUrl));
                        }
                    }
                    //继续轮询
                    else if (data.control_type == 'h5_route_need_pay_query') {
                        if(!data.data.stopQuery) {
                            setTimeout(function(){
                                argumentsPayquery.callee();
                            }, data.data.dismisstime);
                        }
                    }
                }
            });
        }
        //第一次等待轮询
        window.setTimeout(function(){
            payquery();
        }, timeCount);
    });
</script>
<script>
    (function (w, d, t) {
        var s = d.createElement(t), m = d.getElementsByTagName(t)[0];
        s.async = 1;
        s.src = "https://g.alicdn.com/sd/pointman/js/pt2.js?f=m&_=" + Math.floor((new Date()).getTime() / 36e5);
        m.parentNode.insertBefore(s, m);

        w._pointman_q = w._pointman_q || [];
        _pointman_q.push(["um", function (um) {
            um.init({
                timeout: 3000,
                token:'P8288585d8627e1cb14215aa9b3097f07',
                userid: '',
                serviceLocation: "cn",
                appName: 'mobileclientgw'
            });
        }]);
    })(window, document, "script");
</script>

<script>
    (function (win) {
        win.APDID_API_KEY = 'h5cashier';
        win.APDID_USER_ID = '';
        win.APDID_SESSION = 'GZ00KYDaX2qplIqBXX8wVeqFnySdntmobileclientgwGZ00';
        var sandAjax = function(Zepto) {
            setTimeout(function () {
                Zepto.ajax({
                    url: 'https://as.alipayobjects.com/g/component/apdid-cn-entry/0.0.1/cnentry.js',
                    dataType: "script",
                    cache: true
                });
            }, 50);
        }
        if($){
            sandAjax($)
        } else {
            win.seajs && win.seajs.use(['$'], function ($) {
                sandAjax($)
            });
        }
    })(window);
</script>
<footer>
    <div class="alipay-logo"></div>
    <div id="ServerNum">mobileclientgw-70-49</div>
</footer>
<!-- CMS:安全支付客户端网关/common/footer.vm开始:mobileclientgw/common/footer.vm -->	<script type="text/javascript">
    if(navigator.userAgent.indexOf('sdk') > 0) {$('input[data-format]').attr('data-format', '100')}
    //12.03下线
    if(window.Zepto && Zepto.dialog && $('.J-header-return') != -1){
        Zepto.dialog.hide = function() {
            $('body').find('.am-dialog-mask').animate({
                opacity: 0
            }, 400, 'ease-out', function(){
                $(this).css('display', 'none');
            });
            $('body').find('.am-dialog-box').animate({
                opacity: 0
            }, 400, 'ease-out', function(){
                $(this).css('display', 'none');
            });
            window.setTimeout(function(){
                $('body').find('.am-dialog-mask').remove();
                $('body').find('.am-dialog-box').remove();
            },1000);
        }
    }
</script><!-- CMS:安全支付客户端网关/common/footer.vm结束:mobileclientgw/common/footer.vm --></body>
</html>